#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Проверяем, начинается ли сообщение с FE: или BE:
if ! [[ $COMMIT_MSG =~ ^(FE:|BE:).* ]]; then
    echo "Ошибка: сообщение коммита должно начинаться с 'FE:' или 'BE:'"
    echo "Пример:"
    echo "FE: Добавить новую функциональность"
    echo "или"
    echo "BE: Исправить баг в API"
    exit 1
fi

# Обрабатываем сообщение:
# 1. Удаляем все точки
# 2. Удаляем пробелы в начале и конце, заменяем множественные пробелы на один
# 3. Делаем первую букву после : заглавной
PROCESSED_MSG=$(echo "$COMMIT_MSG" |
    sed -e 's/\.//g' |          # Удаляем точки
    sed -e 's/^[[:space:]]*//' | # Удаляем пробелы в начале
    sed -e 's/[[:space:]]*$//' | # Удаляем пробелы в конце
    tr -s ' ' |                 # Удаляем двойные пробелы
    perl -pe 's/(^[^:]+:\s*)(.)/$1\U$2/') # Первую букву после : делаем заглавной

# Записываем обработанное сообщение обратно в файл
echo "$PROCESSED_MSG" > "$COMMIT_MSG_FILE"

exit 0
